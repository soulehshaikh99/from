document.addEventListener("DOMContentLoaded",(function(){let e="";const t=$.qs("#contact-us-form"),n=$.qs("#email-field"),c=$.qs("#subject-field"),o=$.qs("#message-field"),i=$.qs("#terms-acceptance-consent"),r=$.qs("#submit-contact-form-btn"),a=$.qs("#submit-contact-btn-text");function s(e,t){const n=window.forge.pki.publicKeyFromPem(t);return window.forge.util.encode64(n.encrypt(e,"RSA-OAEP"))}function u(e="hide"){"show"===e?(r.classList.add("ri"),a.textContent="Sending..."):(r.classList.remove("ri"),a.textContent="Send message")}function d(e="",t=0){setTimeout((()=>{alert(e)}),t)}const l=(f="email",new URLSearchParams(window.location.search).get(f));var f;l&&(n.value=l,function(e){const t=new URLSearchParams(window.location.search);t.delete(e);const n=window.location.pathname+(t.toString()?"?"+t.toString():"");window.history.replaceState({},"",n)}("email")),t.addEventListener("submit",(async function(r){r.preventDefault();try{const r=n.value,a=c.value,l=o.value,f=i.checked;if(a.length>100)return void d("Subject cannot exceed 100 characters.");if(l.length>500)return void d("Message cannot exceed 500 characters.");if(!f)return void d("Please accept the Terms of Service and Privacy Policy before submitting.");u("show");const m=await async function(){if(e)return{success:!0,publicKey:e};try{const t=await fetch("/api/getPublicKey",{method:"GET"}),n=await t.json();return e=n.publicKey,{success:!0,publicKey:e}}catch(e){return{success:!1,publicKey:null}}}();if(!m.success)throw new Error("Failed to fetch public key");const{key:y,iv:w}={key:window.forge.random.getBytesSync(32),iv:window.forge.random.getBytesSync(16)},h=function(e,t,n){const c=window.forge.cipher.createCipher("AES-CBC",t);return c.start({iv:n}),c.update(window.forge.util.createBuffer(e)),c.finish(),c.output.toHex()}(JSON.stringify({email:r,subject:a,message:l}),y,w),g=s(y,m.publicKey),S=s(w,m.publicKey),p=await fetch(t.action,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:h+"."+g+"."+S})}),b=await p.json();u("hide"),d(b.message,50),"success"===b.status&&t.reset()}catch(e){d("Something went wrong. Please try again.")}finally{u("hide")}}))}));