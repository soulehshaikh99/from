document.addEventListener("DOMContentLoaded",(function(){const e=$.qs("#currencySelect"),t=$.qs("#stockAveragePrice"),c=$.qs("#totalQuantity"),o=$.qs("#totalAmount"),l=$.qs("#currentPL"),r=$.qs("#totalReturn"),a=$.qs("#breakEvenPrice"),n=$.qs("#effectivePL"),u=$.qs("#netReturn"),s=$.qs("#showDetailedBreakdownBtn"),i=$.qs("#addStockPurchaseBtn"),v=$.qs("#currentMarketPrice"),g=$.qs("#brokerageFees"),_=$.qs("#taxesAndCharges"),y=$.qs("#detailedBreakdownReport"),d=$.qs(".stockavgcal-output__investment-breakdown"),S=$.qs(".stockavgcal-output__portfolio-summary"),q=$.qs(".stockavgcal-output__breakeven-metrics"),m=$.qs(".stockavgcal-output__price-insights"),k=$.qs("#resetFieldsBtn"),p=$.qs("#calculateAverage"),h=$.qsa(".stockavgcal__mode-input"),f=$.qs(".stockavgcal__advanced-paramters");function b(){for(const e of h)if(e.checked)return e.value;return null}function x(e){"basic"===(e=e||b())?$.conceal(l.closest(".uk"),r.closest(".uk"),f):$.reveal(f),$.conceal(y)}function L(e=1){if(e>=1&&e<=10)return["First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth"][e-1];const t=(()=>{const t=e%10,c=e%100;return 1===t&&11!==c?"st_conflict":2===t&&12!==c?"nd_conflict":3===t&&13!==c?"rd_conflict":"th"})();return`${e}${t}`}function C(e,t){let c=e.querySelector(".stockavgcal__purchase-remove");function o(){t.removeChild(e),function(){const e=$.qs(".up");for(let t=0;t<e.children.length;t++){const c=e.children[t],o=c.querySelector(".stockavgcal__purchase-heading");let l=L(t+1);o.textContent=`${l} Purchase`,l=l.toLowerCase(),c.querySelector(".stockavgcal__purchase-label--buy-price").setAttribute("for",`${l}-purchase`),c.querySelector(".stockavgcal__purchase-buy-price").id=`${l}-purchase`,c.querySelector(".stockavgcal__purchase-label--quantity").setAttribute("for",`${l}-quantity`),c.querySelector(".stockavgcal__purchase-quantity").id=`${l}-quantity`}N()}(),E()}if(c)return c.removeEventListener("click",o),void c.addEventListener("click",o);c=document.createElement("img"),c.classList.add("stockavgcal__purchase-remove"),c.setAttribute("src","/assets/images/8ee27068.svg"),e.querySelector(".stockavgcal__purchase-heading").after(c),c.addEventListener("click",o)}function F(e){const t=e.querySelector(".stockavgcal__purchase-remove");t&&t.remove()}function N(){const e=$.qs(".up"),t=$.qsa(".ud");if(t.length>=3)for(let c=0;c<2;c++)C(t[c],e);else for(let e=0;e<t.length;e++)F(t[e])}function A(e){const t=$.qsa(".stockavgcal__preferred-currency");for(let c=0;c<t.length;c++){t[c].textContent=e}}function E(){const e=b(),i=$.qsa(".ud");let k=0,p=0,h=1/0,f=-1/0;const x=[];for(const e of i){const t=e.querySelector(".stockavgcal__purchase-buy-price"),c=e.querySelector(".stockavgcal__purchase-quantity"),o=parseFloat(t.value||0),l=parseFloat(c.value||0);k+=l,p+=o*l,h>o&&(h=o),f<o&&(f=o),x.push({buyPrice:o,quantity:l,invested:(o*l).toFixed(2)})}if(!p||!k)return;const C=k>0?p/k:0,F=Number(C.toFixed(2)).toLocaleString(),N=Number(k.toFixed(2)).toLocaleString(),A=Number(p.toFixed(2)).toLocaleString();t.textContent=F,c.textContent=N,o.textContent=A;const E=parseFloat(v.value||0),P=parseFloat(g.value||0),w=parseFloat(_.value||0);if(E>0&&k>0){const e=E*k-p,t=e/p*100;l.textContent=`${e>=0?"+":""}${Number(e.toFixed(2)).toLocaleString()}`,r.textContent=`${t>=0?"+":""}${Number(t.toFixed(2)).toLocaleString()}%`,l.classList.toggle("in-profit",e>0),l.classList.toggle("in-loss",e<0),r.classList.toggle("in-profit",t>0),r.classList.toggle("in-loss",t<0),$.reveal(l.closest(".uk"),r.closest(".uk"))}else $.conceal(l.closest(".uk"),r.closest(".uk"));if(P>0||w>0){const e=P+w,t=(p+e)/k;if(a.textContent=Number(t.toFixed(2)).toLocaleString(),$.reveal(a.closest(".uk")),E>0){const t=E*k-p-e,c=t/p*100;n.textContent=`${t>=0?"+":""}${Number(t.toFixed(2)).toLocaleString()}`,u.textContent=`${c>=0?"+":""}${Number(c.toFixed(2)).toLocaleString()}%`,$.reveal(n.closest(".uk"),u.closest(".uk"))}else $.conceal(n.closest(".uk"),u.closest(".uk"))}else $.conceal(a.closest(".uk"),n.closest(".uk"),u.closest(".uk"));$.reveal(s);const B=d.querySelectorAll(".ae");for(let e=1;e<B.length;e++)B[e].remove();let I=0,R=1/0,z=-1/0,D=0,Z=0;const M=B[0];for(let t=0;t<x.length;t++){const c=x[t],o=M.cloneNode(!0);let l=0;t===x.length-1?l=Number((100-I).toFixed(2)):p>0&&(l=(c.invested/p*100).toFixed(2),I+=Number(l)),R>l&&(R=l,D=c.buyPrice),z<l&&(z=l,Z=c.buyPrice);const r=o.querySelector(".stockavgcal__current-column"),a=o.querySelector(".stockavgcal__current-pl-column"),n=o.querySelector(".stockavgcal__net-change-column"),u=o.querySelector(".stockavgcal__allocation-column");if(o.querySelector(".at").textContent=`${L(t+1)} Purchase`,o.querySelector(".stockavgcal__buy-price-value").textContent=c.buyPrice.toLocaleString(),o.querySelector(".stockavgcal__quantity-value").textContent=c.quantity.toLocaleString(),o.querySelector(".stockavgcal__invested-value").textContent=Number(c.invested).toLocaleString(),o.querySelector(".stockavgcal__allocation-value").textContent=`${Number(l)}%`,"basic"===e?$.conceal(r,a,n,u):$.reveal(r,a,n,u),"advanced"===e&&E>0){const e=o.querySelector(".stockavgcal__current-pl-value"),t=o.querySelector(".stockavgcal__net-change-value"),l=(E*c.quantity).toFixed(2),r=(l-c.invested).toFixed(2),a=(r/c.invested*100).toFixed(2);o.querySelector(".stockavgcal__current-value").textContent=Number(l).toLocaleString(),e.textContent=`${r>=0?"+":""}${Number(r).toLocaleString()}`,t.textContent=`${a>=0?"+":""}${Number(a).toLocaleString()}%`,e.classList.toggle("in-profit",r>0),e.classList.toggle("in-loss",r<0),t.classList.toggle("in-profit",r>0),t.classList.toggle("in-loss",r<0)}else $.conceal(r,a,n);d.querySelector(".stockavgcal-output__purchase-list").appendChild(o)}M.remove();const T=S.querySelector(".stockavgcal__cmp-column"),O=S.querySelector(".stockavgcal__total-column"),Q=S.querySelector(".stockavgcal__total-pl-column"),U=S.querySelector(".stockavgcal__total-return-column");if("basic"===e?$.conceal(T,O,Q,U):$.reveal(T,O,Q,U),S.querySelector(".stockavgcal__average-buy-price-value").textContent=F,S.querySelector(".stockavgcal__total-quantity-value").textContent=N,S.querySelector(".stockavgcal__total-invested-value").textContent=A,"advanced"===e&&E>0){const e=E*k,t=e-p,c=t/p*100,o=S.querySelector(".stockavgcal__total-pl-value"),l=S.querySelector(".stockavgcal__total-return-value");S.querySelector(".stockavgcal__cmp-value").textContent=E.toLocaleString(),S.querySelector(".stockavgcal__total-value").textContent=Number(e).toLocaleString(),o.textContent=`${t>=0?"+":""}${Number(t.toFixed(2)).toLocaleString()}`,l.textContent=`${c>=0?"+":""}${Number(c.toFixed(2)).toLocaleString()}%`,o.classList.toggle("in-profit",t>0),o.classList.toggle("in-loss",t<0),l.classList.toggle("in-profit",t>0),l.classList.toggle("in-loss",t<0)}else $.conceal(T,O,Q,U);if(Z===D?$.conceal(m.querySelector(".stockavgcal__highest-allocation-column"),m.querySelector(".stockavgcal__lowest-allocation-column")):($.reveal(m.querySelector(".stockavgcal__highest-allocation-column"),m.querySelector(".stockavgcal__lowest-allocation-column")),m.querySelector(".stockavgcal__highest-allocation-value").textContent=Number(Z).toLocaleString(),m.querySelector(".stockavgcal__lowest-allocation-value").textContent=Number(D).toLocaleString()),h===f?$.conceal(m.querySelector(".stockavgcal__cheapest-buy-column"),m.querySelector(".stockavgcal__expensive-buy-column")):($.reveal(m.querySelector(".stockavgcal__cheapest-buy-column"),m.querySelector(".stockavgcal__expensive-buy-column")),m.querySelector(".stockavgcal__cheapest-buy-value").textContent=Number(h).toLocaleString(),m.querySelector(".stockavgcal__expensive-buy-value").textContent=Number(f).toLocaleString()),"advanced"===e&&(P>0||w>0)){const e=P+w,t=(p+e)/k,c=t-C;if(q.querySelector(".stockavgcal__total-charges-value").textContent=e.toLocaleString(),q.querySelector(".stockavgcal__breakeven-price-value").textContent=Number(t.toFixed(2)).toLocaleString(),q.querySelector(".stockavgcal__points-to-breakeven-value").textContent=Number(c.toFixed(2)).toLocaleString(),E>0){const t=E*k-p-e,c=t/p*100;q.querySelector(".stockavgcal__effective-pl-value").textContent=`${t>=0?"+":""}${Number(t.toFixed(2)).toLocaleString()}`,q.querySelector(".stockavgcal__net-return-value").textContent=`${c>=0?"+":""}${Number(c.toFixed(2)).toLocaleString()}%`,$.reveal(q.querySelector(".stockavgcal__effective-pl-column"),q.querySelector(".stockavgcal__net-return-column"))}else $.conceal(q.querySelector(".stockavgcal__effective-pl-column"),q.querySelector(".stockavgcal__net-return-column"));$.reveal(q)}else $.conceal(q);$.reveal(y,d,S),Z!==D||h!==f?$.reveal(m):$.conceal(m)}$.qs("#contact-us-form").addEventListener("submit",(function(e){e.preventDefault();const t=$.qs("#email-field").value;/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(t)?window.location.href="/contact-us.html?email="+encodeURIComponent(t):alert("Please enter a valid email address.")})),x(),function(){e.addEventListener("change",(e=>{const t=e.target.value;t&&sessionStorage.setItem("currency-preference",t),A(t)})),i.addEventListener("click",(()=>{!function(){const e=$.qs(".up");let t=L(e.children.length+1);const c=$.qs(".ud").cloneNode(!0);c.querySelector(".stockavgcal__purchase-heading").textContent=`${t} Purchase`,t=t.toLowerCase(),c.querySelector(".stockavgcal__purchase-label--buy-price").setAttribute("for",`${t}-purchase`),c.querySelector(".stockavgcal__purchase-buy-price").id=`${t}-purchase`,c.querySelector(".stockavgcal__purchase-label--quantity").setAttribute("for",`${t}-quantity`),c.querySelector(".stockavgcal__purchase-quantity").id=`${t}-quantity`,c.querySelector(".stockavgcal__purchase-buy-price").value="",c.querySelector(".stockavgcal__purchase-quantity").value="",e.appendChild(c),C(c,e),N()}()})),p.addEventListener("click",(()=>{E()})),k.addEventListener("click",(()=>{!function(){const e=$.qsa(".ud");for(const t of e){const e=t.querySelector(".stockavgcal__purchase-buy-price"),c=t.querySelector(".stockavgcal__purchase-quantity");e.value=0,c.value=0}t.textContent=0,c.textContent=0,o.textContent=0,v.value=0,g.value=0,_.value=0,$.conceal(l.closest(".uk"),r.closest(".uk"),a.closest(".uk"),n.closest(".uk"),u.closest(".uk"),s,y,d,S,q,m);const i=d.querySelectorAll(".ae");for(let e=1;e<i.length;e++)i[e].remove()}()}));for(const e of h)e.addEventListener("change",(e=>{x(e.target.value)}));const f=sessionStorage.getItem("currency-preference");f&&(e.value=f,A(f)),s.addEventListener("click",(function(){y.scrollIntoView({behavior:"smooth"})}))}()}));