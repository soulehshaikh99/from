document.addEventListener("DOMContentLoaded",(function(){const e=$.qs("#currencySelect"),t=$.qs("#stockAveragePrice"),c=$.qs("#totalQuantity"),o=$.qs("#totalAmount"),l=$.qs("#currentPL"),r=$.qs("#totalReturn"),a=$.qs("#breakEvenPrice"),n=$.qs("#effectivePL"),u=$.qs("#netReturn"),s=$.qs("#showDetailedBreakdownBtn"),i=$.qs("#addStockPurchaseBtn"),v=$.qs("#currentMarketPrice"),g=$.qs("#brokerageFees"),_=$.qs("#taxesAndCharges"),y=$.qs("#detailedBreakdownReport"),d=$.qs(".stockavgcal-output__investment-breakdown"),S=$.qs(".stockavgcal-output__portfolio-summary"),q=$.qs(".stockavgcal-output__breakeven-metrics"),m=$.qs(".stockavgcal-output__price-insights"),k=$.qs("#resetFieldsBtn"),h=$.qs("#calculateAverage"),p=$.qsa(".stockavgcal__mode-input"),f=$.qs(".stockavgcal__advanced-paramters");function b(){for(const e of p)if(e.checked)return e.value;return null}function x(e){"basic"===(e=e||b())?$.conceal(l.closest(".uw"),r.closest(".uw"),f):$.reveal(f),$.conceal(y)}function L(e=1){if(e>=1&&e<=10)return["First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth"][e-1];const t=(()=>{const t=e%10,c=e%100;return 1===t&&11!==c?"st_conflict":2===t&&12!==c?"nd_conflict":3===t&&13!==c?"rd_conflict":"th"})();return`${e}${t}`}function C(e,t){let c=e.querySelector(".stockavgcal__purchase-remove");function o(){t.removeChild(e),function(){const e=$.qs(".uc");for(let t=0;t<e.children.length;t++){const c=e.children[t],o=c.querySelector(".stockavgcal__purchase-heading");let l=L(t+1);o.textContent=`${l} Purchase`,l=l.toLowerCase(),c.querySelector(".stockavgcal__purchase-label--buy-price").setAttribute("for",`${l}-purchase`),c.querySelector(".stockavgcal__purchase-buy-price").id=`${l}-purchase`,c.querySelector(".stockavgcal__purchase-label--quantity").setAttribute("for",`${l}-quantity`),c.querySelector(".stockavgcal__purchase-quantity").id=`${l}-quantity`}F()}(),A()}if(c)return c.removeEventListener("click",o),void c.addEventListener("click",o);c=document.createElement("img"),c.classList.add("stockavgcal__purchase-remove"),c.setAttribute("src","/assets/images/a6d3e123.svg"),e.querySelector(".stockavgcal__purchase-heading").after(c),c.addEventListener("click",o)}function w(e){const t=e.querySelector(".stockavgcal__purchase-remove");t&&t.remove()}function F(){const e=$.qs(".uc"),t=$.qsa(".uh");if(t.length>=3)for(let c=0;c<2;c++)C(t[c],e);else for(let e=0;e<t.length;e++)w(t[e])}function N(e){const t=$.qsa(".stockavgcal__preferred-currency");for(let c=0;c<t.length;c++){t[c].textContent=e}}function A(){const e=b(),i=$.qsa(".uh");let k=0,h=0,p=1/0,f=-1/0;const x=[];for(const e of i){const t=e.querySelector(".stockavgcal__purchase-buy-price"),c=e.querySelector(".stockavgcal__purchase-quantity"),o=parseFloat(t.value||0),l=parseFloat(c.value||0);k+=l,h+=o*l,p>o&&(p=o),f<o&&(f=o),x.push({buyPrice:o,quantity:l,invested:(o*l).toFixed(2)})}if(!h||!k)return;const C=k>0?h/k:0,w=Number(C.toFixed(2)).toLocaleString(),F=Number(k.toFixed(2)).toLocaleString(),N=Number(h.toFixed(2)).toLocaleString();t.textContent=w,c.textContent=F,o.textContent=N;const A=parseFloat(v.value||0),E=parseFloat(g.value||0),P=parseFloat(_.value||0);if(A>0&&k>0){const e=A*k-h,t=e/h*100;l.textContent=`${e>=0?"+":""}${Number(e.toFixed(2)).toLocaleString()}`,r.textContent=`${t>=0?"+":""}${Number(t.toFixed(2)).toLocaleString()}%`,l.classList.toggle("in-profit",e>0),l.classList.toggle("in-loss",e<0),r.classList.toggle("in-profit",t>0),r.classList.toggle("in-loss",t<0),$.reveal(l.closest(".uw"),r.closest(".uw"))}else $.conceal(l.closest(".uw"),r.closest(".uw"));if(E>0||P>0){const e=E+P,t=(h+e)/k;if(a.textContent=Number(t.toFixed(2)).toLocaleString(),$.reveal(a.closest(".uw")),A>0){const t=A*k-h-e,c=t/h*100;n.textContent=`${t>=0?"+":""}${Number(t.toFixed(2)).toLocaleString()}`,u.textContent=`${c>=0?"+":""}${Number(c.toFixed(2)).toLocaleString()}%`,$.reveal(n.closest(".uw"),u.closest(".uw"))}else $.conceal(n.closest(".uw"),u.closest(".uw"))}else $.conceal(a.closest(".uw"),n.closest(".uw"),u.closest(".uw"));$.reveal(s);const B=d.querySelectorAll(".uq");for(let e=1;e<B.length;e++)B[e].remove();let z=0,I=1/0,R=-1/0,D=0,Z=0;const M=B[0];for(let t=0;t<x.length;t++){const c=x[t],o=M.cloneNode(!0);let l=0;t===x.length-1?l=Number((100-z).toFixed(2)):h>0&&(l=(c.invested/h*100).toFixed(2),z+=Number(l)),I>l&&(I=l,D=c.buyPrice),R<l&&(R=l,Z=c.buyPrice);const r=o.querySelector(".stockavgcal__current-column"),a=o.querySelector(".stockavgcal__current-pl-column"),n=o.querySelector(".stockavgcal__net-change-column"),u=o.querySelector(".stockavgcal__allocation-column");if(o.querySelector(".uz").textContent=`${L(t+1)} Purchase`,o.querySelector(".stockavgcal__buy-price-value").textContent=c.buyPrice.toLocaleString(),o.querySelector(".stockavgcal__quantity-value").textContent=c.quantity.toLocaleString(),o.querySelector(".stockavgcal__invested-value").textContent=Number(c.invested).toLocaleString(),o.querySelector(".stockavgcal__allocation-value").textContent=`${Number(l)}%`,"basic"===e?$.conceal(r,a,n,u):$.reveal(r,a,n,u),"advanced"===e&&A>0){const e=o.querySelector(".stockavgcal__current-pl-value"),t=o.querySelector(".stockavgcal__net-change-value"),l=(A*c.quantity).toFixed(2),r=(l-c.invested).toFixed(2),a=(r/c.invested*100).toFixed(2);o.querySelector(".stockavgcal__current-value").textContent=Number(l).toLocaleString(),e.textContent=`${r>=0?"+":""}${Number(r).toLocaleString()}`,t.textContent=`${a>=0?"+":""}${Number(a).toLocaleString()}%`,e.classList.toggle("in-profit",r>0),e.classList.toggle("in-loss",r<0),t.classList.toggle("in-profit",r>0),t.classList.toggle("in-loss",r<0)}else $.conceal(r,a,n);d.querySelector(".stockavgcal-output__purchase-list").appendChild(o)}M.remove();const T=S.querySelector(".stockavgcal__cmp-column"),O=S.querySelector(".stockavgcal__total-column"),Q=S.querySelector(".stockavgcal__total-pl-column"),U=S.querySelector(".stockavgcal__total-return-column");if("basic"===e?$.conceal(T,O,Q,U):$.reveal(T,O,Q,U),S.querySelector(".stockavgcal__average-buy-price-value").textContent=w,S.querySelector(".stockavgcal__total-quantity-value").textContent=F,S.querySelector(".stockavgcal__total-invested-value").textContent=N,"advanced"===e&&A>0){const e=A*k,t=e-h,c=t/h*100,o=S.querySelector(".stockavgcal__total-pl-value"),l=S.querySelector(".stockavgcal__total-return-value");S.querySelector(".stockavgcal__cmp-value").textContent=A.toLocaleString(),S.querySelector(".stockavgcal__total-value").textContent=Number(e).toLocaleString(),o.textContent=`${t>=0?"+":""}${Number(t.toFixed(2)).toLocaleString()}`,l.textContent=`${c>=0?"+":""}${Number(c.toFixed(2)).toLocaleString()}%`,o.classList.toggle("in-profit",t>0),o.classList.toggle("in-loss",t<0),l.classList.toggle("in-profit",t>0),l.classList.toggle("in-loss",t<0)}else $.conceal(T,O,Q,U);if(Z===D?$.conceal(m.querySelector(".stockavgcal__highest-allocation-column"),m.querySelector(".stockavgcal__lowest-allocation-column")):($.reveal(m.querySelector(".stockavgcal__highest-allocation-column"),m.querySelector(".stockavgcal__lowest-allocation-column")),m.querySelector(".stockavgcal__highest-allocation-value").textContent=Number(Z).toLocaleString(),m.querySelector(".stockavgcal__lowest-allocation-value").textContent=Number(D).toLocaleString()),p===f?$.conceal(m.querySelector(".stockavgcal__cheapest-buy-column"),m.querySelector(".stockavgcal__expensive-buy-column")):($.reveal(m.querySelector(".stockavgcal__cheapest-buy-column"),m.querySelector(".stockavgcal__expensive-buy-column")),m.querySelector(".stockavgcal__cheapest-buy-value").textContent=Number(p).toLocaleString(),m.querySelector(".stockavgcal__expensive-buy-value").textContent=Number(f).toLocaleString()),"advanced"===e&&(E>0||P>0)){const e=E+P,t=(h+e)/k,c=t-C;if(q.querySelector(".stockavgcal__total-charges-value").textContent=e.toLocaleString(),q.querySelector(".stockavgcal__breakeven-price-value").textContent=Number(t.toFixed(2)).toLocaleString(),q.querySelector(".stockavgcal__points-to-breakeven-value").textContent=Number(c.toFixed(2)).toLocaleString(),A>0){const t=A*k-h-e,c=t/h*100;q.querySelector(".stockavgcal__effective-pl-value").textContent=`${t>=0?"+":""}${Number(t.toFixed(2)).toLocaleString()}`,q.querySelector(".stockavgcal__net-return-value").textContent=`${c>=0?"+":""}${Number(c.toFixed(2)).toLocaleString()}%`,$.reveal(q.querySelector(".stockavgcal__effective-pl-column"),q.querySelector(".stockavgcal__net-return-column"))}else $.conceal(q.querySelector(".stockavgcal__effective-pl-column"),q.querySelector(".stockavgcal__net-return-column"));$.reveal(q)}else $.conceal(q);$.reveal(y,d,S),Z!==D||p!==f?$.reveal(m):$.conceal(m)}$.qs("#contact-us-form").addEventListener("submit",(function(e){e.preventDefault();const t=$.qs("#email-field").value;/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(t)?window.location.href="/contact-us.html?email="+encodeURIComponent(t):alert("Please enter a valid email address.")})),x(),function(){e.addEventListener("change",(e=>{const t=e.target.value;t&&sessionStorage.setItem("currency-preference",t),N(t)})),i.addEventListener("click",(()=>{!function(){const e=$.qs(".uc");let t=L(e.children.length+1);const c=$.qs(".uh").cloneNode(!0);c.querySelector(".stockavgcal__purchase-heading").textContent=`${t} Purchase`,t=t.toLowerCase(),c.querySelector(".stockavgcal__purchase-label--buy-price").setAttribute("for",`${t}-purchase`),c.querySelector(".stockavgcal__purchase-buy-price").id=`${t}-purchase`,c.querySelector(".stockavgcal__purchase-label--quantity").setAttribute("for",`${t}-quantity`),c.querySelector(".stockavgcal__purchase-quantity").id=`${t}-quantity`,c.querySelector(".stockavgcal__purchase-buy-price").value="",c.querySelector(".stockavgcal__purchase-quantity").value="",e.appendChild(c),C(c,e),F()}()})),h.addEventListener("click",(()=>{A()})),k.addEventListener("click",(()=>{!function(){const e=$.qsa(".uh");for(const t of e){const e=t.querySelector(".stockavgcal__purchase-buy-price"),c=t.querySelector(".stockavgcal__purchase-quantity");e.value=0,c.value=0}t.textContent=0,c.textContent=0,o.textContent=0,v.value=0,$.conceal(l.closest(".uw"),r.closest(".uw"),a.closest(".uw"),n.closest(".uw"),u.closest(".uw"),s,y,d,S,q,m);const i=d.querySelectorAll(".uq");for(let e=1;e<i.length;e++)i[e].remove()}()}));for(const e of p)e.addEventListener("change",(e=>{x(e.target.value)}));const g=sessionStorage.getItem("currency-preference");g&&(e.value=g,N(g)),s.addEventListener("click",(function(){y.scrollIntoView({behavior:"smooth"})}))}()}));